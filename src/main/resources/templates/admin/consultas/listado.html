<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: layout(~{::content}, 'consultas')}">
<head>
    <title>Gestión de Consultas | Panel Admin</title>
</head>
<body>
    <div th:fragment="content" style="padding: 1.5rem;">
        <!-- Header Section -->
        <div class="consultas-header">
            <div class="consultas-header-top">
                <div class="consultas-title">
                    <i class="fas fa-inbox" style="font-size: 1.5rem;"></i>
                    <div>
                        <h3>Gestión de Consultas</h3>
                        <p class="consultas-subtitle">Administra y responde las consultas recibidas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="consultas-stats">
            <div class="consultas-stat-card">
                <span class="consultas-stat-number" th:text="${pendientes}">0</span>
                <span class="consultas-stat-label">Pendientes</span>
            </div>
            <div class="consultas-stat-card">
                <span class="consultas-stat-number" th:text="${enProceso}">0</span>
                <span class="consultas-stat-label">En Proceso</span>
            </div>
            <div class="consultas-stat-card">
                <span class="consultas-stat-number" th:text="${respondidas}">0</span>
                <span class="consultas-stat-label">Respondidas</span>
            </div>
            <div class="consultas-stat-card">
                <span class="consultas-stat-number" th:text="${citasProgramadas}">0</span>
                <span class="consultas-stat-label">Citas Programadas</span>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="consultas-toolbar">
            <div class="consultas-search-row">
                <form method="get" th:action="@{/admin/consultas}" class="consultas-search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" 
                           name="busqueda" 
                           th:value="${busqueda}" 
                           placeholder="Buscar por ticket, DNI o nombre...">
                </form>
                
                <div class="consultas-filters">
                    <form method="get" th:action="@{/admin/consultas}" style="display: flex; gap: 0.5rem; align-items: flex-end;">
                        <div class="consultas-filter-group">
                            <label class="consultas-filter-label">Filtrar por Estado</label>
                            <select name="estado" class="consultas-filter-select">
                                <option value="">Todos los estados</option>
                                <option value="PENDIENTE" th:selected="${estadoActual == 'PENDIENTE'}">Pendiente</option>
                                <option value="EN_PROCESO" th:selected="${estadoActual == 'EN_PROCESO'}">En Proceso</option>
                                <option value="RESPONDIDA" th:selected="${estadoActual == 'RESPONDIDA'}">Respondida</option>
                                <option value="CITA_PROGRAMADA" th:selected="${estadoActual == 'CITA_PROGRAMADA'}">Cita Programada</option>
                            </select>
                        </div>
                        <button type="submit" class="consultas-btn consultas-btn-primary">
                            <i class="fas fa-search"></i>
                            Buscar
                        </button>
                        <a th:href="@{/admin/consultas}" class="consultas-btn consultas-btn-secondary">
                            <i class="fas fa-times-circle"></i>
                            Limpiar
                        </a>
                    </form>
                </div>
            </div>
        </div>

        <!-- Table Container -->
        <div class="consultas-table-container">
            <div style="overflow-x: auto;">
                <table class="consultas-table">
                    <thead>
                        <tr>
                            <th>Ticket / Fecha</th>
                            <th>Cliente</th>
                            <th>Contacto</th>
                            <th>Tipo de Consulta</th>
                            <th>Estado</th>
                            <th style="text-align: center;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="consulta, i : ${consultas}" th:if="${i.index > 0}">
                            <td>
                                <div class="consultas-ticket">
                                    <span class="consultas-ticket" th:text="${consulta.get(8)}">CON-123</span>
                                    <div class="consultas-fecha">
                                        <i class="far fa-calendar"></i>
                                        <span th:text="${consulta.get(0)}">02/02/2026 23:47</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="consultas-cliente">
                                    <span class="consultas-cliente-nombre" th:text="${consulta.get(1)} + ' ' + ${consulta.get(2)}">Juan Pérez</span>
                                    <div class="consultas-cliente-info" th:if="${consulta.size() > 4 and consulta.get(4) != null}">
                                        <i class="fas fa-phone"></i>
                                        <span th:text="${consulta.get(4)}">999999999</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="consultas-contacto">
                                    <div class="consultas-contacto-item">
                                        <i class="far fa-envelope"></i>
                                        <a th:href="'mailto:' + ${consulta.get(3)}" th:text="${consulta.get(3)}">email@example.com</a>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span th:text="${consulta.get(5)}">Tipo de consulta</span>
                            </td>
                            <td>
                                <span class="consultas-badge"
                                      th:classappend="${consulta.get(7) == 'PENDIENTE' ? 'consultas-badge-pendiente' : 
                                                        consulta.get(7) == 'EN_PROCESO' ? 'consultas-badge-proceso' :
                                                        consulta.get(7) == 'CITA_PROGRAMADA' ? 'consultas-badge-cita' : 'consultas-badge-respondida'}"
                                      th:text="${consulta.get(7)}">
                                    Pendiente
                                </span>
                            </td>
                            <td style="text-align: center;">
                                <div class="consultas-actions" style="justify-content: center;">
                                    <a th:href="@{/admin/consultas/detalle(ticket=${consulta.get(8)})}" 
                                       class="consultas-btn consultas-btn-primary"
                                       style="padding: 0.5rem 1rem; font-size: 0.875rem;"
                                       title="Ver detalles y responder">
                                        <i class="fas fa-eye"></i>
                                        Ver Detalle
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr th:if="${consultas.size() &lt;= 1}">
                            <td colspan="6" style="text-align: center; padding: 3rem; color: #9ca3af;">
                                <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                                <p>No hay consultas para mostrar</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
