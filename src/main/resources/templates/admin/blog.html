<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: layout(~{::content}, 'blog')}">
<head>
    <title>Gestión de Blog | Panel Admin</title>
</head>
<body>
    <div th:fragment="content">
        <!-- Header Section -->
        <div style="background: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #e5e7eb; margin-bottom: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="font-size: 1.125rem; font-weight: 700; color: #312e81; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-blog" style="color: #4f46e5;"></i>
                        Gestión de Blog
                    </h3>
                    <p style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">Administra artículos desde Google Sheets o desde el panel</p>
                </div>
                <a th:href="@{/admin/blog/listado}" style="background: #4f46e5; color: white; padding: 0.625rem 1.25rem; border-radius: 0.5rem; text-decoration: none; font-weight: 500; transition: background 0.2s; display: inline-flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-list"></i>
                    Ver todos los artículos
                </a>
            </div>
        </div>

        <!-- Mensaje de error -->
        <div th:if="${error}" style="background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
            <i class="fas fa-exclamation-triangle"></i> <span th:text="${error}"></span>
        </div>

        <!-- Estadísticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Artículos</h3>
                <div class="number" th:text="${totalArticulos ?: 0}">0</div>
            </div>
            <div class="stat-card">
                <h3>Artículo Destacado</h3>
                <div class="number" th:text="${tieneDestacado ? 'SÍ' : 'NO'}">NO</div>
            </div>
            <div class="stat-card">
                <h3>Artículos Normales</h3>
                <div class="number" th:text="${articulos?.size() ?: 0}">0</div>
            </div>
        </div>

        <!-- Gestión rápida desde el dashboard -->
        <div class="blog-header" style="margin-top: 1.5rem;">
            <div class="blog-title-section" style="margin-bottom: 1rem;">
                <h2 class="blog-title" style="font-size: 1.25rem;">Gestión rápida</h2>
                <div style="display: flex; gap: 0.75rem;">
                    <a th:href="@{/admin/blog/nuevo}" class="blog-btn-new">
                        <i class="fas fa-plus"></i>
                        Nuevo Artículo
                    </a>
                </div>
            </div>

            <div class="blog-stats">
                <div class="blog-stat-card">
                    <div class="blog-stat-label">Total Artículos</div>
                    <div class="blog-stat-value" th:text="${totalArticulosGestion}">0</div>
                </div>
                <div class="blog-stat-card">
                    <div class="blog-stat-label">Publicados</div>
                    <div class="blog-stat-value" th:text="${articulosPublicadosGestion}">0</div>
                </div>
                <div class="blog-stat-card">
                    <div class="blog-stat-label">Borradores</div>
                    <div class="blog-stat-value" th:text="${articulosBorradoresGestion}">0</div>
                </div>
                <div class="blog-stat-card">
                    <div class="blog-stat-label">Destacados</div>
                    <div class="blog-stat-value" th:text="${articulosDestacadosGestion}">0</div>
                </div>
            </div>
        </div>

        <div class="blog-table-container">
            <table class="blog-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Título</th>
                        <th>Categoría</th>
                        <th>Fecha</th>
                        <th>Estado</th>
                        <th>Destacado</th>
                        <th>Autor</th>
                        <th style="text-align: center;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:if="${#lists.isEmpty(articulosGestion)}">
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #9ca3af;">
                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                            No hay artículos para gestionar
                        </td>
                    </tr>
                    <tr th:each="articulo : ${articulosGestion}">
                        <td th:text="${articulo.id}">1</td>
                        <td>
                            <div style="font-weight: 500; color: #1f2937;" th:text="${articulo.titulo}">Título</div>
                            <div style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.25rem;" th:text="${#strings.abbreviate(articulo.resumen, 60)}">Resumen...</div>
                        </td>
                        <td th:text="${articulo.categoria}">Salud</td>
                        <td th:text="${articulo.fecha}">01/01/2026</td>
                        <td>
                            <span th:class="${articulo.estado == 'PUBLICADO' ? 'blog-badge blog-badge-publicado' : 'blog-badge blog-badge-borrador'}" 
                                  th:text="${articulo.estado}">PUBLICADO</span>
                        </td>
                        <td>
                            <span th:class="${articulo.destacado == true ? 'blog-badge blog-badge-destacado' : 'blog-badge blog-badge-normal'}" 
                                  th:text="${articulo.destacado == true ? 'Destacado' : 'Normal'}">Normal</span>
                        </td>
                        <td th:text="${articulo.autor}">Admin</td>
                        <td style="text-align: center;">
                            <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                <a th:href="@{/admin/blog/editar(id=${articulo.id})}" 
                                   class="blog-btn blog-btn-primary" 
                                   style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                    <i class="fas fa-edit"></i>
                                    Editar
                                </a>
                                <form th:action="@{/admin/blog/cambiar-estado}" method="post" style="margin: 0;">
                                    <input type="hidden" name="id" th:value="${articulo.id}">
                                    <input type="hidden" name="nuevoEstado" th:value="${articulo.estado == 'PUBLICADO' ? 'BORRADOR' : 'PUBLICADO'}">
                                    <button type="submit" 
                                            th:class="${articulo.estado == 'PUBLICADO' ? 'blog-btn blog-btn-warning' : 'blog-btn blog-btn-success'}"
                                            th:title="${articulo.estado == 'PUBLICADO' ? 'Cambiar a borrador (ocultar)' : 'Publicar (mostrar en web)'}"
                                            style="padding: 0.5rem 1rem; font-size: 0.875rem; border: none; cursor: pointer;">
                                        <i th:class="${articulo.estado == 'PUBLICADO' ? 'fas fa-eye-slash' : 'fas fa-eye'}"></i>
                                        <span th:text="${articulo.estado == 'PUBLICADO' ? 'Ocultar' : 'Publicar'}">Publicar</span>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Previsualización -->
        <div style="background: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid #e5e7eb;">
            <h2 style="font-size: 1rem; font-weight: 600; color: #312e81; margin-bottom: 1.5rem;">
                <i class="fas fa-eye"></i> Previsualización del Blog
            </h2>

            <!-- Artículo Destacado -->
            <div th:if="${destacado != null}" style="margin-bottom: 2rem; border-radius: 0.5rem; overflow: hidden; border: 1px solid #e5e7eb;">
                <img th:src="${destacado.imagen}" 
                     th:alt="${destacado.titulo}" 
                     style="width: 100%; height: 300px; object-fit: cover;"
                     onerror="this.src='https://via.placeholder.com/800x300?text=Sin+Imagen'">
                <div style="padding: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; font-size: 0.875rem; color: #6b7280;">
                        <span style="background: #eef2ff; color: #4338ca; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;" th:text="${destacado.categoria}">Categoría</span>
                        <span th:text="${destacado.fecha}">Fecha</span>
                        <span th:if="${destacado.autor != null and !destacado.autor.isEmpty()}">
                            <i class="fas fa-user"></i> <span th:text="${destacado.autor}">Autor</span>
                        </span>
                    </div>
                    <h3 style="font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 0.5rem;" th:text="${destacado.titulo}">Título del artículo destacado</h3>
                    <p style="color: #6b7280; line-height: 1.6;" th:text="${destacado.resumen}">Resumen del artículo...</p>
                </div>
            </div>

            <div th:if="${destacado == null}" style="background: #dbeafe; border: 1px solid #bfdbfe; color: #1e40af; padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem;">
                <i class="fas fa-info-circle"></i> No hay artículo destacado. Marca un artículo con <strong>Destacado = SI</strong> en Google Sheets.
            </div>

            <!-- Artículos Normales -->
            <div th:if="${articulos != null and !articulos.isEmpty()}" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                <div th:each="articulo : ${articulos}" style="border-radius: 0.5rem; overflow: hidden; border: 1px solid #e5e7eb; transition: box-shadow 0.2s;">
                    <img th:src="${articulo.imagen}" 
                         th:alt="${articulo.titulo}" 
                         style="width: 100%; height: 180px; object-fit: cover;"
                         onerror="this.src='https://via.placeholder.com/300x180?text=Sin+Imagen'">
                    <div style="padding: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; font-size: 0.75rem; color: #6b7280;">
                            <span style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-weight: 600;" th:text="${articulo.categoria}">Categoría</span>
                            <span th:text="${articulo.fecha}">Fecha</span>
                        </div>
                        <h4 style="font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;" th:text="${articulo.titulo}">Título del artículo</h4>
                        <p style="color: #6b7280; font-size: 0.875rem; line-height: 1.5;" th:text="${articulo.resumen}">Resumen breve...</p>
                    </div>
                </div>
            </div>

            <div th:if="${articulos == null or articulos.isEmpty()}" style="text-align: center; padding: 3rem; color: #9ca3af;">
                <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                <p>No hay artículos publicados. Agrega artículos con <strong>Estado = PUBLICADO</strong> en Google Sheets.</p>
            </div>
        </div>
    </div>
</body>
</html>
